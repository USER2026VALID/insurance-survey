<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿éšªéœ€æ±‚æ¬Šé‡åˆ†æ</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --selected: #27ae60;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            position: relative;
        }

        h1, h2, h3 { text-align: center; color: var(--primary); margin-bottom: 15px; }
        p { text-align: center; color: #666; margin-bottom: 25px; line-height: 1.6; }

        .progress-bar {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 0.9em; }
        input[type="text"], input[type="tel"] {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 6px; font-size: 16px;
            box-sizing: border-box; background: #fff;
        }

        /* é¸é …å¡ç‰‡æ¨£å¼ (å¡«ç©ºé¢¨æ ¼) */
        .option-pool {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-card {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .option-card:hover {
            border-color: #bbb;
            background-color: #f9f9f9;
        }

        /* é¸ä¸­ç‹€æ…‹ */
        .option-card.selected {
            border-color: var(--selected);
            background-color: #f0fff4;
        }

        /* å·¦å´æ–¹æ¡† (æ¨¡æ“¬å¡«ç©º) */
        .rank-box {
            width: 32px;
            height: 32px;
            border: 2px solid #ccc;
            border-radius: 6px;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            background: white;
            transition: all 0.2s;
            flex-shrink: 0; /* é˜²æ­¢è¢«æ“ å£“ */
        }

        /* æ•¸å­—é¡¯ç¤º */
        .option-card.selected .rank-box {
            background-color: var(--selected);
            border-color: var(--selected);
        }

        .option-text {
            font-size: 1rem;
            color: #333;
            line-height: 1.4;
        }

        .step { display: none; animation: fadeIn 0.4s; }
        .step.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-btn {
            background-color: var(--primary); color: white; border: none;
            padding: 12px 30px; border-radius: 6px; font-size: 16px;
            cursor: pointer; width: 100%; margin-top: 20px;
            opacity: 0.5; pointer-events: none; transition: all 0.3s;
        }
        .nav-btn.ready { opacity: 1; pointer-events: auto; background-color: var(--accent); }

        .radio-group { display: flex; gap: 20px; margin-bottom: 15px; }
        .radio-label { display: flex; align-items: center; cursor: pointer; background: #fff; padding: 10px 20px; border: 1px solid #ddd; border-radius: 6px; width: 100%; }
        .radio-label input { margin-right: 8px; }

        #loading-spinner { display: none; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <div id="step-intro" class="step active">
        <h2>ğŸ“Š ä¿éšªæ¬Šé‡åˆ†æ</h2>
        <p>é€™ä»½å•å·å°‡é€éæ’åºæ³•ï¼Œ<br>ç²¾æº–åˆ†ææ‚¨å°å„é …ä¿éšœçš„é‡è¦–ç¨‹åº¦ã€‚</p>
        
        <label>å§“å</label>
        <input type="text" id="clientName" placeholder="è«‹è¼¸å…¥å§“å">
        
        <label>æ€§åˆ¥</label>
        <div class="radio-group">
            <label class="radio-label"><input type="radio" name="clientSex" value="ç”·"> ç”·</label>
            <label class="radio-label"><input type="radio" name="clientSex" value="å¥³"> å¥³</label>
        </div>

        <label>ç”Ÿæ—¥ (å¦‚ï¼š19860101)</label>
        <input type="tel" id="clientDob" placeholder="YYYYMMDD" maxlength="8">

        <label>è·æ¥­</label>
        <input type="text" id="clientJob" placeholder="ä¾‹å¦‚ï¼šå·¥ç¨‹å¸«">

        <label>è¯çµ¡æ–¹å¼ (æ‰‹æ©Ÿ / Line ID)</label>
        <input type="text" id="clientContact" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼æˆ– Line ID">
        
        <div style="border-top: 1px dashed #ccc; margin: 25px 0;"></div>

        <label style="color: var(--accent); font-size: 1.1em;">è¦åŠƒå°è±¡</label>
        <div class="option-pool">
            <button class="option-card" style="justify-content:center; font-weight:bold;" onclick="selectTarget('self')">A. åªæœ‰æˆ‘è‡ªå·±</button>
            <button class="option-card" style="justify-content:center; font-weight:bold;" onclick="selectTarget('family')">B. åªæœ‰å®¶äºº</button>
            <button class="option-card" style="justify-content:center; font-weight:bold;" onclick="selectTarget('both')">C. å…©è€…éƒ½è¦</button>
        </div>
    </div>

    <div id="step-question" class="step">
        <h4 id="q-category" style="text-align:center; color:#999; margin:0;">é¡åˆ¥</h4>
        <h3 id="q-text" style="margin-top:5px;">å•é¡Œæ¨™é¡Œ</h3>
        <p style="font-size:0.9em; margin-bottom:15px; color:#e74c3c;">
            è«‹ä¾åºé»æ“Šé¸é …ï¼Œæ¨™ç¤ºå‡º 1ã€2ã€3ã€4 å
        </p>
        
        <div class="option-pool" id="q-options">
            </div>

        <button id="next-btn" class="nav-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>
        <p style="font-size:0.8em; margin-top:10px; color:#999; cursor:pointer;" onclick="resetCurrentRank()">â†» é»æ­¤é‡æ–°æ’åºæœ¬é¡Œ</p>
    </div>

    <div id="step-result" class="step">
        <div id="final-message">
            <h2>ğŸ”„ æ­£åœ¨è¨ˆç®—æ¬Šé‡...</h2>
            <p>ç³»çµ±æ­£åœ¨åˆ†ææ‚¨çš„æ’åºé‚è¼¯...</p>
            <div id="loading-spinner">â³ ä¸Šå‚³ä¸­...</div>
        </div>
    </div>

</div>

<script>
    // ğŸ”´ ä½ çš„ Google Script ç¶²å€
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwNNc9BZ0AJzTGGYK4cnqAsuA78FtWMuuVoJMmn4hZpOSWuVCy0N6eLyPk-h414ZkJD/exec';

    /* === é¡Œåº«è³‡æ–™ (å®Œæ•´æ“´å……ç‰ˆ) === */
    
    // ã€è‡ªæˆ‘è¦åŠƒã€‘å®Œæ•´ 10 é¡Œ
    const questionsSelf = [
        { 
            cat: "ã€è‡ªæˆ‘ã€‘ç”Ÿå­˜é¢¨éšª", 
            q: "å¦‚æœä¸å¹¸ç™¼ç”Ÿäº‹æ•…ï¼Œä½ æœ€æ“”å¿ƒç„¡æ³•è§£æ±ºçš„å•é¡Œæ˜¯ï¼Ÿ", 
            opts: [
                { text: "é•·æœŸè‡¥åºŠéœ€äººç…§é¡§ï¼Œæ‹–ç´¯å®¶äººçš„éŒ¢", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ç½¹æ‚£é‡ç—‡ï¼Œæ€¥éœ€ä¸€å¤§ç­†éŒ¢æ²»ç™‚", tag: "é‡å¤§å‚·ç—…" },
                { text: "ä½é™¢æ‰‹è¡“èŠ±è²»é«˜ï¼Œç©è“„ç¬é–“æ­¸é›¶", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "èµ°å¾—å¤ªæ—©ï¼Œç•™ä¸‹çš„æˆ¿è²¸èˆ‡è²¬ä»»æœªäº†", tag: "å£½éšªè²¬ä»»" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘é ç®—åˆ†é…", 
            q: "å¦‚æœé ç®—æœ‰é™ï¼Œä½ å¸Œæœ›ä¿è²»å„ªå…ˆèŠ±åœ¨ï¼Ÿ", 
            opts: [
                { text: "ç¢ºä¿æ¯æœˆæœ‰ç”Ÿæ´»è²» (å¤±èƒ½æ‰¶åŠ©)", tag: "å¤±èƒ½é•·ç…§" },
                { text: "è§£æ±ºé«˜é¡è‡ªè²»è—¥ç‰© (å¯¦æ”¯å¯¦ä»˜)", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "æ‹¿åˆ°ä¸€ç­†æ€¥ç”¨é‡‘ (ç™Œç—‡/é‡å¤§å‚·ç—…)", tag: "é‡å¤§å‚·ç—…" },
                { text: "ç™¼ç”Ÿæ„å¤–æ™‚çš„ä¿éšœ (æ„å¤–éšª)", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘æ²»ç™‚å“è³ª", 
            q: "å‡è¨­ç”Ÿç—…ä½é™¢ï¼Œä½ æœ€åœ¨æ„çš„å“è³ªæ˜¯ï¼Ÿ", 
            opts: [
                { text: "ä¸ç”¨å®¶äººè¼ªç­ï¼Œæœ‰éŒ¢è«‹çœ‹è­·", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ä½¿ç”¨æœ€å¥½çš„è‡ªè²»é†«æ/é”æ–‡è¥¿æ‰‹è¡“", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "å®‰å¿ƒä¼‘é¤Šï¼Œä¸ç”¨æ“”å¿ƒæ²’å·¥ä½œæ”¶å…¥", tag: "é‡å¤§å‚·ç—…" },
                { text: "å‡ç­‰å–®äººç—…æˆ¿ï¼Œä¼‘é¤Šä¸è¢«æ‰“æ“¾", tag: "é†«ç™‚å¯¦æ”¯" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘å£“åŠ›ä¾†æº", 
            q: "å“ªä¸€ç¨®è²¡å‹™å£“åŠ›æœƒè®“ä½ æ„Ÿåˆ°æœ€ç„¦æ…®ï¼Ÿ", 
            opts: [
                { text: "æ¯å€‹æœˆå›ºå®šè¦æ”¯å‡ºçš„çœ‹è­·è²»ç”¨", tag: "å¤±èƒ½é•·ç…§" },
                { text: "çªç„¶è¦æ‹¿å‡ºå¹¾åè¬çš„æ‰‹è¡“è²»", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç„¡æ³•å·¥ä½œå°è‡´å®¶åº­æ”¶å…¥ä¸­æ–·", tag: "é‡å¤§å‚·ç—…" },
                { text: "æ„å¤–ç™¼ç”Ÿå°è‡´èº«é«”æ®˜ç¼º", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘ä¿éšœåŠŸèƒ½", 
            q: "è²·ä¿éšªå°ä½ ä¾†èªªï¼Œæœ€é‡è¦çš„æ„ç¾©æ˜¯ï¼Ÿ", 
            opts: [
                { text: "è€å¾Œä¸æˆç‚ºå­©å­çš„è² æ“” (å°Šåš´)", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ç”Ÿç—…æ™‚æœ‰æ¬Šåˆ©é¸æ“‡å¥½çš„æ²»ç™‚ (å“è³ª)", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç™¼ç”Ÿå¤§äº‹æ™‚æœ‰éŒ¢èƒ½æ‡‰æ€¥ (å®‰å…¨æ„Ÿ)", tag: "é‡å¤§å‚·ç—…" },
                { text: "çµ¦å®¶äººç•™ä¸€ä»½æ„›èˆ‡è²¬ä»» (å‚³æ‰¿)", tag: "å£½éšªè²¬ä»»" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘ä½¿ç”¨æƒ…å¢ƒ", 
            q: "ä»¥ä¸‹å“ªç¨®ç‹€æ³ç™¼ç”Ÿåœ¨ä½ èº«ä¸Šï¼Œä½ æœƒè¦ºå¾—ã€Œå¹¸å¥½æœ‰è²·ä¿éšªã€ï¼Ÿ", 
            opts: [
                { text: "è¢«åˆ¤å®šå¤±èƒ½ï¼Œæ¯å€‹æœˆä¿éšªå…¬å¸åŒ¯éŒ¢ä¾†", tag: "å¤±èƒ½é•·ç…§" },
                { text: "çµå¸³æ™‚çœ‹åˆ°é«˜é¡æ”¶æ“šï¼Œä¿éšªå…¨è³ ", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç¢ºè¨ºç™Œç—‡ï¼Œæˆ¶é ­ç›´æ¥å¤šäº†ä¸€ç™¾è¬", tag: "é‡å¤§å‚·ç—…" },
                { text: "ç™¼ç”Ÿè»Šç¦éª¨æŠ˜ï¼Œç†è³ é‡‘å¤ ä¼‘é¤ŠåŠå¹´", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘é¢¨éšªæ©Ÿç‡", 
            q: "ç›´è¦ºä¸Šï¼Œä½ è¦ºå¾—è‡ªå·±æœªä¾† 10 å¹´æœ€å¯èƒ½é‡åˆ°ï¼Ÿ", 
            opts: [
                { text: "èº«é«”æ©Ÿèƒ½é€€åŒ–ï¼Œéœ€è¦ä»–äººå”åŠ©", tag: "å¤±èƒ½é•·ç…§" },
                { text: "æ…¢æ€§ç—…æˆ–æ–‡æ˜ç—…ï¼Œéœ€é•·æœŸæ²»ç™‚", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç™Œç—‡æˆ–å¿ƒè¡€ç®¡ç–¾ç—…çªç™¼", tag: "é‡å¤§å‚·ç—…" },
                { text: "é¨è»Š/é–‹è»Š/é‹å‹•ç™¼ç”Ÿçš„æ„å¤–å‚·å®³", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘ç¼ºå£å¡«è£œ", 
            q: "å¦‚æœçœŸçš„ç„¡æ³•å·¥ä½œäº†ï¼Œä½ å¸Œæœ›ä¿éšªå¹«ä½ è§£æ±ºï¼Ÿ", 
            opts: [
                { text: "åƒé ˜è–ªæ°´ä¸€æ¨£ï¼ŒæŒçºŒçµ¦ä»˜ç”Ÿæ´»è²»", tag: "å¤±èƒ½é•·ç…§" },
                { text: "æ”¯ä»˜é†«é™¢é‚£äº›å¥ä¿ä¸çµ¦ä»˜çš„é …ç›®", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "å…ˆçµ¦æˆ‘ä¸€ç­†éŒ¢ï¼Œè®“æˆ‘é‚„æ¸…è²¸æ¬¾", tag: "é‡å¤§å‚·ç—…" },
                { text: "ç•™ä¸€ç­†éŒ¢çµ¦çˆ¶æ¯æˆ–å°å­©éæ—¥å­", tag: "å£½éšªè²¬ä»»" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘ç†è³ åå¥½", 
            q: "ä½ æ¯”è¼ƒå–œæ­¡å“ªç¨®ç†è³ æ–¹å¼ï¼Ÿ", 
            opts: [
                { text: "ç´°æ°´é•·æµï¼Œä¿éšœè·Ÿè‘—æˆ‘ä¸€è¼©å­", tag: "å¤±èƒ½é•·ç…§" },
                { text: "èŠ±å¤šå°‘è³ å¤šå°‘ï¼Œå¯¦å ±å¯¦éŠ·", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ä¸€æ¬¡æ‹¿ä¸€å¤§ç­†ï¼Œæˆ‘è‡ªå·±æ±ºå®šæ€éº¼ç”¨", tag: "é‡å¤§å‚·ç—…" },
                { text: "ç´„å®šå¥½é‡‘é¡ï¼Œç™¼ç”Ÿå°±å®šé¡çµ¦ä»˜", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€è‡ªæˆ‘ã€‘æœ€çµ‚æ±ºç­–", 
            q: "æœ€å¾Œä¸€é¡Œï¼Œå¦‚æœåªèƒ½é¸ä¸€å€‹ã€Œçµ•å°ä¸èƒ½å°‘ã€çš„ä¿éšœï¼Ÿ", 
            opts: [
                { text: "å¤±èƒ½/é•·ç…§éšª (è§£æ±ºæ´»å¤ªä¹…çš„å•é¡Œ)", tag: "å¤±èƒ½é•·ç…§" },
                { text: "å¯¦æ”¯å¯¦ä»˜ (è§£æ±ºç—…å¤ªä¹…çš„å•é¡Œ)", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "é‡å¤§å‚·ç—… (è§£æ±ºç—…å¤ªé‡çš„å•é¡Œ)", tag: "é‡å¤§å‚·ç—…" },
                { text: "æ„å¤–/å£½éšª (è§£æ±ºèµ°å¤ªå¿«/çªç™¼å•é¡Œ)", tag: "å£½éšªæ„å¤–" }
            ]
        }
    ];

    // ã€å®¶äººè¦åŠƒã€‘å®Œæ•´ 10 é¡Œ
    const questionsFamily = [
        { 
            cat: "ã€å®¶äººã€‘ç…§é¡§æ“”æ†‚", 
            q: "ç•¶å®¶äººç”Ÿç—…å€’ä¸‹ï¼Œä½ æœ€æ€•é¢è‡¨ä»€éº¼ç‹€æ³ï¼Ÿ", 
            opts: [
                { text: "éœ€é•·æœŸè‡¥åºŠï¼Œçœ‹è­·è²»æ¯æœˆ3-5è¬", tag: "å¤±èƒ½é•·ç…§" },
                { text: "çªç„¶éœ€è¦å¹¾åè¬çš„æ‰‹è¡“è²»/å™¨æè²»", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç‚ºäº†ç…§é¡§å®¶äººï¼Œæˆ‘è¢«è¿«è¾­è·æ–·ç‚Š", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ä¸çŸ¥é“è©²æ€éº¼æ²»ç™‚ï¼Œéœ€è¦å°‹æ±‚åé†«", tag: "é‡å¤§å‚·ç—…" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘ç¶“æ¿Ÿè¡æ“Š", 
            q: "å¦‚æœé•·è¼©ç”Ÿç—…ï¼Œå°ä½ æœ€å¤§çš„å½±éŸ¿æ˜¯ï¼Ÿ", 
            opts: [
                { text: "é•·æœŸç‡’éŒ¢ï¼Œåƒç„¡åº•æ´ä¸€æ¨£", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ç•¶ä¸‹æ‹¿ä¸å‡ºè¶³å¤ çš„ç¾é‡‘", tag: "é‡å¤§å‚·ç—…" },
                { text: "é†«é™¢é›œè²»å¤ªè²´ï¼Œè² æ“”ä¸èµ·", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "éœ€é »ç¹è«‹å‡é™ªè¨ºï¼Œå½±éŸ¿å·¥ä½œ", tag: "å¤±èƒ½é•·ç…§" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘ä¿éšœåŠŸèƒ½", 
            q: "å¹«å®¶äººè²·ä¿éšªï¼Œä½ æœ€ä¸»è¦çš„ç›®çš„æ˜¯ï¼Ÿ", 
            opts: [
                { text: "è®“ä¿éšªå…¬å¸å¹«å¿™å‡ºçœ‹è­·è²» (è²·äººåŠ›)", tag: "å¤±èƒ½é•·ç…§" },
                { text: "è®“å®¶äººèƒ½ç”¨æœ€å¥½çš„è—¥ç‰© (è²·å°Šåš´)", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç™¼ç”Ÿå¤§äº‹æ™‚æœ‰ä¸€ç­†éŒ¢å¥½è¾¦äº‹ (è²·è³‡æº)", tag: "é‡å¤§å‚·ç—…" },
                { text: "è¬ä¸€è·Œå€’éª¨æŠ˜èƒ½æœ‰è£œè²¼ (è²·æ„å¤–)", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘é¢¨éšªé åˆ¤", 
            q: "ä»¥å®¶äººçš„å¹´ç´€èˆ‡é«”æ³ï¼Œä½ è¦ºå¾—æœ€å¯èƒ½ç™¼ç”Ÿï¼Ÿ", 
            opts: [
                { text: "å¤±æ™º/ä¸­é¢¨ï¼Œéœ€è¦å°ˆäººç…§é¡§", tag: "å¤±èƒ½é•·ç…§" },
                { text: "è·Œå€’/éª¨æŠ˜/è»Šç¦ç­‰æ„å¤–å‚·å®³", tag: "æ„å¤–é¢¨éšª" },
                { text: "ç™Œç—‡/å¿ƒè‚Œæ¢—å¡ç­‰é‡å¤§ç–¾ç—…", tag: "é‡å¤§å‚·ç—…" },
                { text: "æ…¢æ€§ç—…ä½é™¢ï¼Œåè¦†é€²å‡ºé†«é™¢", tag: "é†«ç™‚å¯¦æ”¯" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘é ç®—å–æ¨", 
            q: "å¦‚æœé ç®—æœ‰é™ï¼Œä½ æƒ³å…ˆå¹«å®¶äººè§£æ±ºï¼Ÿ", 
            opts: [
                { text: "æ¯å€‹æœˆå›ºå®šçš„ç…§é¡§é–‹éŠ·", tag: "å¤±èƒ½é•·ç…§" },
                { text: "ä½é™¢æ™‚çš„é«˜é¡è‡ªè²»é …ç›®", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ç¢ºè¨ºç•¶ä¸‹çš„ç·Šæ€¥é å‚™é‡‘", tag: "é‡å¤§å‚·ç—…" },
                { text: "æ—¥å¸¸ç”Ÿæ´»çš„å°æ„å¤–ç†è³ ", tag: "æ„å¤–é¢¨éšª" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘å®¶åº­å’Œè«§", 
            q: "ä½ è¦ºå¾—å“ªç¨®ç†è³ ï¼Œå°å®¶åº­æ°£æ°›å¹«åŠ©æœ€å¤§ï¼Ÿ", 
            opts: [
                { text: "æ¯æœˆå®šæœŸçµ¦ä»˜ï¼Œä¸ç”¨å…„å¼Ÿå§Šå¦¹æ”¤éŒ¢", tag: "å¤±èƒ½é•·ç…§" },
                { text: "å¯¦å ±å¯¦éŠ·ï¼Œä¸ç”¨æ“”å¿ƒè—¥è²»èª°å‡º", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "ä¸€æ¬¡çµ¦ä»˜ï¼Œå®¶äººå¯å•†é‡å¦‚ä½•é‹ç”¨", tag: "é‡å¤§å‚·ç—…" },
                { text: "èº«æ•…ç•™æ„›ï¼Œé¿å…éºç”¢ç´›çˆ­", tag: "å£½éšªè²¬ä»»" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘ç…§é¡§è³‡æº", 
            q: "å¦‚æœå®¶äººéœ€è¦äººç…§é¡§ï¼Œç›®å‰çš„ç‹€æ³æ˜¯ï¼Ÿ", 
            opts: [
                { text: "ç„¡äººæ‰‹ï¼Œä¸€å®šè¦èŠ±éŒ¢è«‹çœ‹è­·/æ©Ÿæ§‹", tag: "å¤±èƒ½é•·ç…§" },
                { text: "æœ‰äººæ‰‹ï¼Œä½†éœ€è¦éŒ¢è£œè²¼å®¶ç”¨", tag: "å¤±èƒ½é•·ç…§" },
                { text: "éœ€è¦å¥½çš„é†«ç™‚å“è³ªè®“ç—…æƒ…å¥½è½‰", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "éœ€è¦ä¸€ç­†éŒ¢æ”¹é€ å±…å®¶ç„¡éšœç¤™ç’°å¢ƒ", tag: "é‡å¤§å‚·ç—…" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘æ„å¤–å ´æ™¯", 
            q: "å¦‚æœæ˜¯é‡å°è€äººå®¶ï¼Œä½ æœ€æ“”å¿ƒå“ªç¨®æ„å¤–ï¼Ÿ", 
            opts: [
                { text: "è·Œå€’å°è‡´è‡¥åºŠä¸èµ· (å¤±èƒ½)", tag: "å¤±èƒ½é•·ç…§" },
                { text: "éª¨æŠ˜éœ€è¦è‡ªè²»æ‰“é‹¼é‡˜/å¾©å¥", tag: "æ„å¤–é¢¨éšª" },
                { text: "äº¤é€šäº‹æ•…å—å‚·ä½é™¢", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "æ„å¤–èº«æ•…", tag: "å£½éšªè²¬ä»»" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘é†«ç™‚å ´æ™¯", 
            q: "å¦‚æœé†«ç”Ÿå»ºè­°ä½¿ç”¨è‡ªè²»é …ç›®(å¦‚æ¨™é¶è—¥ç‰©)ï¼Œä½ æœƒï¼Ÿ", 
            opts: [
                { text: "å¸Œæœ›ä¿éšªèƒ½å…¨é¡è² æ“” (å¯¦æ”¯)", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "å¸Œæœ›æœ‰ä¸€ç­†éŒ¢èƒ½è‡ªç”±é‹ç”¨", tag: "é‡å¤§å‚·ç—…" },
                { text: "æ“”å¿ƒå¾ŒçºŒå‰¯ä½œç”¨éœ€è¦äººç…§é¡§", tag: "å¤±èƒ½é•·ç…§" },
                { text: "è€ƒé‡ç¶“æ¿Ÿç‹€æ³ï¼Œé¸æ“‡å¥ä¿çµ¦ä»˜", tag: "ä¿å®ˆå‹" }
            ]
        },
        { 
            cat: "ã€å®¶äººã€‘æœ€çµ‚æ±ºç­–", 
            q: "æœ€å¾Œæ±ºç­–ï¼Œé€™ä»½ä¿å–®ä¸€å®šè¦å…·å‚™çš„åŠŸèƒ½ï¼Ÿ", 
            opts: [
                { text: "è§£æ±ºã€Œé•·æœŸéœ€è¦äººç…§é¡§ã€çš„éŒ¢", tag: "å¤±èƒ½é•·ç…§" },
                { text: "è§£æ±ºã€Œé«˜é¡é†«ç™‚è²»/æ‰‹è¡“è²»ã€çš„éŒ¢", tag: "é†«ç™‚å¯¦æ”¯" },
                { text: "è§£æ±ºã€Œçªç™¼å¤§ç—…ã€çš„æ€¥ç”¨é‡‘", tag: "é‡å¤§å‚·ç—…" },
                { text: "è§£æ±ºã€Œæ„å¤–çªç™¼ã€çš„ç›¸é—œè²»ç”¨", tag: "æ„å¤–é¢¨éšª" }
            ]
        }
    ];

    // === æ ¸å¿ƒé‚è¼¯ (Tap to Fill Rank) ===
    let currentMode = '';
    let currentQueue = [];
    let answers = [];
    let currentIndex = 0;
    
    // å­˜ç›®å‰é€™é¡Œçš„æ’åº [2, 0, 1] è¡¨ç¤ºé¸é …2æ˜¯ç¬¬1å, é¸é …0æ˜¯ç¬¬2å...
    let currentRank = []; 

    function selectTarget(mode) {
        // è¡¨å–®é©—è­‰
        const name = document.getElementById('clientName').value.trim();
        const contact = document.getElementById('clientContact').value.trim();
        const job = document.getElementById('clientJob').value.trim();
        const dob = document.getElementById('clientDob').value.trim();
        const sexEls = document.getElementsByName('clientSex');
        let sex = ''; for(let el of sexEls) if(el.checked) sex = el.value;

        if (!name || !sex || !contact || !job || !dob) {
            alert("âš ï¸ è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼Œä»¥ä¾¿æˆ‘å€‘æä¾›ç²¾æº–åˆ†æï¼");
            return;
        }

        currentMode = mode;
        if (mode === 'self' || mode === 'both') currentQueue = questionsSelf;
        else currentQueue = questionsFamily;

        document.getElementById('step-intro').classList.remove('active');
        document.getElementById('step-question').classList.add('active');
        loadQuestion();
    }

    function loadQuestion() {
        if (currentIndex >= currentQueue.length) {
            handleFinish();
            return;
        }

        // é‡ç½®ç‹€æ…‹
        currentRank = [];
        document.getElementById('next-btn').classList.remove('ready');

        const qData = currentQueue[currentIndex];
        document.getElementById('q-category').innerText = qData.cat;
        document.getElementById('q-text').innerText = (currentIndex+1) + ". " + qData.q;
        
        const pct = (currentIndex / currentQueue.length) * 100;
        document.getElementById('progress').style.width = pct + "%";

        renderOptions();
    }

    function renderOptions() {
        const qData = currentQueue[currentIndex];
        const pool = document.getElementById('q-options');
        pool.innerHTML = '';

        qData.opts.forEach((opt, idx) => {
            let rankIndex = currentRank.indexOf(idx); // -1 è¡¨ç¤ºæ²’é¸
            let rankNum = rankIndex > -1 ? (rankIndex + 1) : "";
            let isSelected = rankIndex > -1;

            let card = document.createElement('div');
            card.className = `option-card ${isSelected ? 'selected' : ''}`;
            card.onclick = () => toggleOption(idx);

            card.innerHTML = `
                <div class="rank-box">${rankNum}</div>
                <div class="option-text">${opt.text}</div>
            `;
            pool.appendChild(card);
        });

        updateNextBtn();
    }

    function toggleOption(idx) {
        // æª¢æŸ¥æ˜¯å¦å·²é¸
        let rankIndex = currentRank.indexOf(idx);

        if (rankIndex > -1) {
            // å·²é¸ï¼šå–æ¶ˆé¸æ“‡ (å¾é™£åˆ—ç§»é™¤)
            currentRank.splice(rankIndex, 1);
        } else {
            // æœªé¸ï¼šåŠ å…¥é™£åˆ— (å¦‚æœé‚„æ²’æ»¿4å€‹)
            if (currentRank.length < 4) {
                currentRank.push(idx);
            }
        }
        renderOptions();
    }

    function resetCurrentRank() {
        currentRank = [];
        renderOptions();
    }

    function updateNextBtn() {
        const nextBtn = document.getElementById('next-btn');
        if (currentRank.length === 4) {
            nextBtn.classList.add('ready');
            nextBtn.innerText = "ä¸‹ä¸€é¡Œ â”";
        } else {
            nextBtn.classList.remove('ready');
            nextBtn.innerText = `è«‹æ’åºå®Œç•¢ (${currentRank.length}/4)`;
        }
    }

    function nextQuestion() {
        if (currentRank.length < 4) return;

        const qData = currentQueue[currentIndex];
        const rankedTags = currentRank.map(idx => qData.opts[idx].tag);
        
        answers.push({
            q: qData.q,
            rankedTags: rankedTags 
        });

        currentIndex++;
        loadQuestion();
    }

    function handleFinish() {
        if (currentMode === 'both' && currentQueue === questionsSelf) {
            alert("ç¬¬ä¸€éšæ®µå®Œæˆï¼æ¥ä¸‹ä¾†é€²å…¥å®¶äººè¦åŠƒéƒ¨åˆ†ã€‚");
            currentQueue = questionsFamily;
            currentIndex = 0;
            loadQuestion();
        } else {
            submitData();
        }
    }

    // === ğŸ”¥ å¾Œå°åŠ æ¬Šè¨ˆç®—æ ¸å¿ƒ ===
    function submitData() {
        document.getElementById('step-question').classList.remove('active');
        document.getElementById('step-result').classList.add('active');
        document.getElementById('loading-spinner').style.display = 'block';

        const name = document.getElementById('clientName').value;
        const contact = document.getElementById('clientContact').value;
        const job = document.getElementById('clientJob').value;
        const dob = document.getElementById('clientDob').value;
        const sexEls = document.getElementsByName('clientSex');
        let sex = ''; for(let el of sexEls) if(el.checked) sex = el.value;

        // 1. è¨ˆç®—æ¬Šé‡åˆ†æ•¸
        let scores = {}; 

        answers.forEach(ans => {
            // Rank 1 = 4åˆ†, Rank 2 = 3åˆ†...
            ans.rankedTags.forEach((tag, idx) => {
                let score = 4 - idx;
                if (!scores[tag]) scores[tag] = 0;
                scores[tag] += score;
            });
        });

        // 2. æ’åºåˆ†æ•¸ (ç”±é«˜åˆ°ä½)
        let sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
        
        // 3. ç”Ÿæˆå ±å‘Š
        let report = `ã€ğŸ“Š ä¿éšªæ¬Šé‡åˆ†æå ±å‘Šã€‘\n`;
        report += `=========================\n`;
        report += `ğŸ§‘ å®¢æˆ¶ï¼š${name} (${sex})\n`;
        report += `ğŸ‚ ç”Ÿæ—¥ï¼š${dob}\n`;
        report += `ğŸ“± è¯çµ¡ï¼š${contact}\n`;
        report += `ğŸ’¼ è·æ¥­ï¼š${job}\n`;
        report += `ğŸ“‹ æ¨¡å¼ï¼š${currentMode}\n\n`;

        report += `ğŸ† ã€å®¢æˆ¶é‡è¦–éšªç¨®æ’åã€‘\n`;
        sortedScores.forEach((item, index) => {
            report += `No.${index+1} ğŸ”´ ${item[0]} (${item[1]}åˆ†)\n`;
        });
        
        report += `\n-------------------------\n`;
        report += `ã€è©³ç´°æ’åºç´€éŒ„ã€‘\n`;
        answers.forEach((ans, idx) => {
            report += `${idx+1}. ${ans.q}\n`;
            report += `   â”” 1.${ans.rankedTags[0]} > 2.${ans.rankedTags[1]} > 3.${ans.rankedTags[2]} > 4.${ans.rankedTags[3]}\n`;
        });

        // 4. å‚³é€
        let formData = {
            name: name,
            mode: currentMode,
            analysis: report
        };

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(formData)
        })
        .then(() => {
            document.getElementById('final-message').innerHTML = `
                <div style="text-align:center;">
                    <h2 style="color: #27ae60;">âœ… åˆ†æå®Œæˆ</h2>
                    <p>æ„Ÿè¬æ‚¨çš„å¡«å¯«ï¼</p>
                    <p>æ ¹æ“šæ’åºçµæœï¼Œæˆ‘å€‘å·²æ”¶åˆ°æ‚¨æœ€é‡è¦–çš„é …ç›®é †åºã€‚</p>
                    <button class="nav-btn ready" onclick="location.reload()">é—œé–‰</button>
                </div>
            `;
        })
        .catch(() => alert("å‚³é€å¤±æ•—"));
    }
</script>

</body>
</html>
