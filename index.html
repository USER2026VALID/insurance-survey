<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…¨æ–¹ä½ä¿éšªéœ€æ±‚æ¬Šé‡åˆ†æ</title>

<style>
/* CSS æ¨£å¼ (ç¶­æŒåŸæ¨£) */
:root { --primary:#2c3e50; --accent:#e74c3c; --selected:#27ae60; --bg:#f8f9fa; --card:#ffffff; --text:#333; }
body{ font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto; background:var(--bg);margin:0;padding:20px; display:flex;justify-content:center;align-items:center;min-height:100vh; }
.container{ background:var(--card);max-width:620px;width:100%; padding:30px;border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,.08); position: relative; }
h2,h3,h4{text-align:center;color:var(--primary);}
p{text-align:center;color:#666;line-height:1.6}
.progress-bar{height:6px;background:#eee;border-radius:3px;margin-bottom:20px;overflow:hidden}
.progress-fill{height:100%;background:var(--accent);width:0%;transition:.3s}
input[type=text],input[type=tel]{ width:100%;padding:12px;margin-bottom:15px; border:1px solid #ddd;border-radius:6px;font-size:16px; box-sizing: border-box; }
.radio-group{display:flex;gap:10px;margin-bottom:15px}
.radio-label{ flex:1;border:1px solid #ddd;border-radius:6px; padding:10px;display:flex;align-items:center;gap:6px;cursor:pointer; }
.option-pool{display:flex;flex-direction:column;gap:12px}
.option-card{ border:2px solid #e0e0e0;border-radius:10px; padding:15px;cursor:pointer; display:flex;align-items:center;transition:.2s; background: #fff; }
.option-card:hover{background:#f9f9f9}
.option-card.selected{border-color:var(--selected);background:#f0fff4}
.rank-box{ width:32px;height:32px;border-radius:6px; border:2px solid #ccc;margin-right:12px; display:flex;align-items:center;justify-content:center; font-weight:bold;flex-shrink:0;background:#fff; }
.option-card.selected .rank-box{ background:var(--selected);color:#fff;border-color:var(--selected) }
.nav-btn{ width:100%;padding:14px;border:none;border-radius:6px; font-size:16px;margin-top:20px; background:#aaa;color:#fff;opacity:.5;pointer-events:none;transition:.3s; }
.nav-btn.ready{background:var(--accent);opacity:1;pointer-events:auto}
.step{display:none; animation: fadeIn 0.4s;}
.step.active{display:block}
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
.check-btn-group{display:flex;gap:15px;margin-top:20px}
.check-btn{ flex:1;padding:15px;border-radius:8px; border:2px solid #ddd;background:#fff;font-weight:bold;cursor:pointer }
.check-btn.yes{border-color:var(--selected);color:var(--selected)}
.check-btn.no{border-color:var(--accent);color:var(--accent)}

/* çµæœé æ¨£å¼ */
.result-card { border-radius: 10px; padding: 20px; margin-top: 20px; text-align: left; color: #333; border-left: 6px solid #ccc; background: #f9f9f9; }
.result-type-1 { border-left-color: #3498db; background: #eaf6ff; } /* è— */
.result-type-2 { border-left-color: #27ae60; background: #eaffea; } /* ç¶  */
.result-type-3 { border-left-color: #f1c40f; background: #fffbe6; } /* é»ƒ */
.result-title { font-size: 1.4em; font-weight: bold; margin-bottom: 10px; display:block; }
.result-desc { font-size: 0.95em; line-height: 1.6; color: #555; }
.result-list { margin: 10px 0; padding-left: 20px; }
.result-list li { margin-bottom: 5px; }
.strategy-box { border-top: 1px dashed #ccc; margin-top: 15px; padding-top: 15px; font-size: 0.9em; color: #555; }
</style>
</head>

<body>
<div class="container">
<div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

<div id="step-intro" class="step active">
<h2>ğŸ“Š ä¿éšªéœ€æ±‚æ¬Šé‡åˆ†æ</h2>
<p>è«‹å”åŠ©å¡«å¯«åŸºæœ¬è³‡æ–™ï¼Œ<br>é€é 5 å€‹æƒ…å¢ƒé¡Œï¼Œæ‰¾å‡ºæ‚¨æœ€åœ¨æ„çš„ä¿éšœã€‚</p>

<label>å§“å</label><input id="clientName" type="text" placeholder="è«‹è¼¸å…¥å§“å">
<label>æ€§åˆ¥</label>
<div class="radio-group">
<label class="radio-label"><input type="radio" name="clientSex" value="ç”·">ç”·</label>
<label class="radio-label"><input type="radio" name="clientSex" value="å¥³">å¥³</label>
</div>
<label>ç”Ÿæ—¥ (å¦‚: 19850101)</label><input id="clientDob" type="tel" placeholder="YYYYMMDD" maxlength="8">
<label>è·æ¥­</label><input id="clientJob" type="text" placeholder="ä¾‹å¦‚: å·¥ç¨‹å¸«">
<label>è¯çµ¡æ–¹å¼ (æ‰‹æ©Ÿ/Line)</label><input id="clientContact" type="text" placeholder="09xxxxxxxx">

<hr style="border:0; border-top:1px dashed #ccc; margin:20px 0;">
<h3 style="color:var(--accent)">æœ¬æ¬¡è¦åŠƒå°è±¡</h3>
<div class="option-pool">
<button class="option-card" style="justify-content:center;font-weight:bold" onclick="selectTarget('self')">A. åªæœ‰æˆ‘è‡ªå·±</button>
<button class="option-card" style="justify-content:center;font-weight:bold" onclick="selectTarget('family')">B. åªæœ‰å®¶äºº (å°å­©/çˆ¶æ¯/é…å¶)</button>
<button class="option-card" style="justify-content:center;font-weight:bold" onclick="selectTarget('both')">C. è‡ªå·±ï¼‹å®¶äºº</button>
</div>
</div>

<div id="step-question" class="step">
<h4 id="q-category" style="color:#999;margin:0"></h4>
<h3 id="q-text" style="margin-top:5px"></h3>
<p style="color:var(--accent);font-size:0.9em">è«‹ä¾åºé»é¸ 1ï½4 åï¼ˆç¬¬1åæœ€åœ¨æ„ï¼‰</p>
<div class="option-pool" id="q-options"></div>
<button id="next-btn" class="nav-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>
<p style="text-align:center;cursor:pointer;font-size:0.8em;color:#999;margin-top:10px" onclick="resetCurrentRank()">â†» é‡æ–°æ’åºæœ¬é¡Œ</p>
</div>

<div id="step-check" class="step">
<h2>ğŸ›¡ï¸ æœ€å¾Œç¢ºèª</h2>
<p style="font-weight:bold;font-size:1.1em">è«‹å•æ‚¨æ¸…æ¥šè‡ªå·±ç›®å‰èº«ä¸Šæ—¢æœ‰çš„<br>ã€Œæ‰€æœ‰ä¿éšœå…§å®¹ã€å—ï¼Ÿ</p>
<p style="font-size:0.9em">(åŒ…å«å…¬å¸åœ˜ä¿ã€çˆ¶æ¯è²·çš„ä¿å–®...ç­‰)</p>
<div class="check-btn-group">
<button class="check-btn yes" onclick="finishCheck(true)">âœ… æ˜¯ï¼Œæˆ‘å¾ˆæ¸…æ¥š</button>
<button class="check-btn no" onclick="finishCheck(false)">âŒ å¦ï¼Œä¸å¤ªç¢ºå®š</button>
</div>
</div>

<div id="step-result" class="step">
<div id="final-message">
<h2>ğŸ”„ æ­£åœ¨åˆ†æ...</h2>
<p>ç³»çµ±æ­£åœ¨è¨ˆç®—æ‚¨çš„é¢¨éšªæ¬Šé‡...</p>
</div>
<div id="analysis-content"></div>
</div>

</div>

<script>
// ğŸ”´ è«‹å‹™å¿…ç¢ºèªé€™è£¡æ›æˆä½ çš„ Google Script ç¶²å€
const scriptURL = "https://script.google.com/macros/s/AKfycbwNNc9BZ0AJzTGGYK4cnqAsuA78FtWMuuVoJMmn4hZpOSWuVCy0N6eLyPk-h414ZkJD/exec";

const RANK_WEIGHTS = [4,3,2,1];

// æ ¸å¿ƒæ¨™ç±¤å®šç¾© (å°æ‡‰ä¿éšªå››å¤§æ”¯æŸ±)
const TAG_MAP = {
  lump_sum: "ä¸€æ¬¡é‡‘ (é‡å¤§/ç™Œç—‡)",
  monthly_pay: "åˆ†æœŸé‡‘ (å¤±èƒ½/é•·ç…§)",
  medical: "å¯¦æ”¯å¯¦ä»˜ (é†«ç™‚)",
  accident: "æ„å¤–é¢¨éšª (è»Šç¦/éª¨æŠ˜)"
};

// ã€è‡ªæˆ‘è¦åŠƒã€‘ç›´çƒæƒ…å¢ƒé¡Œ
const questionsSelf = [
  {
    id: "A1", cat: "ã€æœ€ä¸æƒ³ç™¼ç”Ÿçš„æƒ…å¢ƒã€‘",
    title: "å¦‚æœæœªä¾†ç™¼ç”Ÿä»¥ä¸‹ç‹€æ³ï¼Œå“ªä¸€å€‹æœƒè®“ä½ æœ€å´©æ½°ï¼Ÿ",
    options: [
      { text: "é†«ç”Ÿèªªæˆ‘ç½¹æ‚£ç™Œç—‡(é‡å¤§å‚·ç—…)ï¼Œéœ€è¦é•·æœŸæŠ—æˆ°", tag: "lump_sum" },
      { text: "å› ç‚ºä¸­é¢¨æˆ–å¤±èƒ½ï¼Œç”Ÿæ´»ç„¡æ³•è‡ªç†ï¼Œéœ€è¦äººç…§é¡§", tag: "monthly_pay" },
      { text: "éœ€è¦å‹•æ‰‹è¡“ï¼Œä½†è‡ªè²»é†«æè¦èŠ± 20~30 è¬", tag: "medical" },
      { text: "é¨è»Šæˆ–èµ°è·¯ç™¼ç”Ÿæ„å¤–ï¼Œéª¨æŠ˜å—å‚·è¦ä¼‘é¤Š", tag: "accident" }
    ]
  },
  {
    id: "A2", cat: "ã€æœ€éœ€è¦çš„å¹«åŠ©ã€‘",
    title: "ç•¶ç‹€æ³ç™¼ç”Ÿæ™‚ï¼Œä¿éšªå…¬å¸æ€éº¼è³ ä½ è¦ºå¾—æœ€æœ‰ç”¨ï¼Ÿ",
    options: [
      { text: "ç›´æ¥åŒ¯çµ¦æˆ‘ä¸€å¤§ç­†éŒ¢ (100è¬ä»¥ä¸Š)ï¼Œè®“æˆ‘è‡ªå·±é‹ç”¨", tag: "lump_sum" },
      { text: "æ¯å€‹æœˆå›ºå®šåŒ¯çµ¦æˆ‘ 3~5 è¬ï¼Œåƒé ˜è–ªæ°´ä¸€æ¨£", tag: "monthly_pay" },
      { text: "å¹«æˆ‘æŠŠé†«é™¢çš„æ”¶æ“šå¸³å–®ä»˜æ‰ (å¯¦å ±å¯¦éŠ·)", tag: "medical" },
      { text: "ä¾ç…§å—å‚·ç¨‹åº¦ï¼Œè³ æˆ‘ä¸€ç­†å›ºå®šçš„æ…°å•é‡‘", tag: "accident" }
    ]
  },
  {
    id: "A3", cat: "ã€éŒ¢è¦è§£æ±ºä»€éº¼å•é¡Œã€‘",
    title: "å¦‚æœé€™ç­†ç†è³ é‡‘ä¸‹ä¾†äº†ï¼Œä½ å¸Œæœ›å®ƒå„ªå…ˆè§£æ±ºï¼Ÿ",
    options: [
      { text: "ç”Ÿç—…æœŸé–“çš„æ”¶å…¥ä¸­æ–·ï¼Œæˆ–æ¨™é¶è—¥ç‰©è²»ç”¨", tag: "lump_sum" },
      { text: "æœªä¾†æ¼«é•·çš„çœ‹è­·è²»ç”¨ã€å®‰é¤Šä¸­å¿ƒè²»ç”¨", tag: "monthly_pay" },
      { text: "ä½é™¢æœŸé–“çš„ç—…æˆ¿è²»ã€æ‰‹è¡“è²»ã€é›œè²»", tag: "medical" },
      { text: "è·Œå€’ã€è»Šç¦å¾Œçš„å¾©å¥è²»æˆ–ä¸èƒ½å·¥ä½œçš„æå¤±", tag: "accident" }
    ]
  },
  {
    id: "A4", cat: "ã€æ“”æ†‚çš„å°è±¡ã€‘",
    title: "ç™¼ç”Ÿäº‹æƒ…æ™‚ï¼Œä½ æœ€æ“”å¿ƒå½±éŸ¿åˆ°ä»€éº¼ï¼Ÿ",
    options: [
      { text: "æ€•å­˜æ¬¾ç¬é–“æ­¸é›¶ï¼Œç¾é‡‘æµå¡ä¸éä¾†", tag: "lump_sum" },
      { text: "æ€•æ‹–ç´¯å®¶äººï¼Œè®“ä»–å€‘å¿…é ˆè¾­è·ç…§é¡§æˆ‘", tag: "monthly_pay" },
      { text: "æ€•ç‚ºäº†çœéŒ¢ï¼Œä¸æ•¢ç”¨æ¯”è¼ƒå¥½çš„è‡ªè²»æ²»ç™‚", tag: "medical" },
      { text: "æ€•çªç™¼ç‹€æ³æ‰“äº‚åŸæœ¬çš„å·¥ä½œèˆ‡ç”Ÿæ´»ç¯€å¥", tag: "accident" }
    ]
  },
  {
    id: "A5", cat: "ã€æœ€å¾Œåº•ç·šã€‘",
    title: "å¦‚æœé ç®—æœ‰é™ï¼Œå“ªä¸€ä»½ä¿éšœä½ çµ•å°ä¸èƒ½å°‘ï¼Ÿ",
    options: [
      { text: "é‡å¤§å‚·ç—…éšª (è§£æ±ºç•¶ä¸‹æ€¥ç”¨)", tag: "lump_sum" },
      { text: "å¤±èƒ½/é•·ç…§éšª (è§£æ±ºé•·æœŸç…§é¡§)", tag: "monthly_pay" },
      { text: "å¯¦æ”¯å¯¦ä»˜é†«ç™‚ (è§£æ±ºé†«é™¢å¸³å–®)", tag: "medical" },
      { text: "æ„å¤–éšª (è§£æ±ºçªç™¼äº‹æ•…)", tag: "accident" }
    ]
  }
];

// ã€å®¶äººè¦åŠƒã€‘å…¨é½¡é€šç”¨ç‰ˆ (å°å­©/è€äºº/é…å¶çš†é©ç”¨)
const questionsFamily = [
  {
    id: "B1", cat: "ã€ç…§é¡§è€…çš„ææ‡¼ã€‘",
    title: "ç•¶å®¶äººç”Ÿç—…æˆ–ç™¼ç”Ÿç‹€æ³ï¼Œèº«ç‚ºå®¶äººçš„ä½ æœ€æ€•é‡åˆ°ï¼Ÿ",
    options: [
      { text: "ç¢ºè¨ºé‡ç—‡ï¼Œçªç„¶è¦ç±Œä¸€å¤§ç­†é†«è—¥è²»", tag: "lump_sum" },
      { text: "ç”Ÿæ´»ç„¡æ³•è‡ªç†ï¼Œéœ€è¦é•·æœŸå°ˆäººç…§é¡§ (æˆ–æˆ‘è¦è¾­è·é¡§)", tag: "monthly_pay" },
      { text: "ä½é™¢æ‰‹è¡“è²»ç”¨å¤ªé«˜ï¼ŒçŒ¶è±«è¦ä¸è¦ç”¨è‡ªè²»", tag: "medical" },
      { text: "è·Œå€’éª¨æŠ˜æˆ–ç™¼ç”Ÿæ„å¤–ï¼Œéœ€è¦èŠ±éŒ¢å¾©å¥", tag: "accident" }
    ]
  },
  {
    id: "B2", cat: "ã€å®¶åº­ç¶“æ¿Ÿå£“åŠ›ã€‘",
    title: "å¦‚æœäº‹æƒ…ç™¼ç”Ÿï¼Œå“ªç¨®é–‹éŠ·æœ€è®“å®¶è£¡åƒä¸æ¶ˆï¼Ÿ",
    options: [
      { text: "ä¸€æ¬¡å¹¾åè¬ã€ä¸Šç™¾è¬çš„æ²»ç™‚è²»æ”¯å‡º", tag: "lump_sum" },
      { text: "æ¯å€‹æœˆå¥½å¹¾è¬çš„ç…§è­·è²»ï¼Œä¸”ä¸çŸ¥é“è¦ä»˜å¤šä¹…", tag: "monthly_pay" },
      { text: "é »ç¹é€²å‡ºé†«é™¢çš„å„é …é›œæ”¯èˆ‡é–‹éŠ·", tag: "medical" },
      { text: "çªç™¼æ„å¤–å°è‡´çš„é¡å¤–èŠ±è²» (å¦‚è«‹å‡æ‰£è–ª)", tag: "accident" }
    ]
  },
  {
    id: "B3", cat: "ã€ç†è³ é‹ç”¨ã€‘",
    title: "ä½ å¸Œæœ›ä¿éšªé‡‘å¦‚ä½•å¹«åŠ©ä½ å€‘å®¶åº¦éé›£é—œï¼Ÿ",
    options: [
      { text: "çµ¦æˆ‘å€‘ä¸€æ•´ç­†éŒ¢ï¼Œè®“æˆ‘å€‘æ±ºå®šæ€éº¼æ•‘", tag: "lump_sum" },
      { text: "æ¯å€‹æœˆå›ºå®šçµ¦ä»˜ï¼Œæ¸›è¼•é•·æœŸé–‹éŠ· (æˆ–è£œè²¼æ”¶å…¥æå¤±)", tag: "monthly_pay" },
      { text: "å¹«å¿™æŠŠé†«é™¢çš„æ”¶æ“šä»˜æ‰ï¼Œä¸ç”¨å‹•åˆ°å­˜æ¬¾", tag: "medical" },
      { text: "é‡å°æ„å¤–å—å‚·çµ¦äºˆè£œè²¼ï¼Œæ¸›è¼•è² æ“”", tag: "accident" }
    ]
  },
  {
    id: "B4", cat: "ã€æœ€å¾Œåº•ç·šã€‘",
    title: "å¹«å®¶äººè¦åŠƒæ™‚ï¼Œä½ æœ€æƒ³å®ˆä½çš„åº•ç·šæ˜¯ï¼Ÿ",
    options: [
      { text: "é‡åˆ°å¤§ç—…æ™‚æœ‰ã€Œæ•‘å‘½éŒ¢ã€ï¼Œä¸ç•™éºæ†¾", tag: "lump_sum" },
      { text: "ç„¡è«–å¦‚ä½•ï¼Œä¸è¦è®“ã€Œæ¼«é•·çš„ç…§é¡§ã€æ‹–å®å…¨å®¶ç¶“æ¿Ÿ", tag: "monthly_pay" },
      { text: "è®“å®¶äººæœ‰æ¬Šåˆ©é¸æ“‡ã€Œæœ€å¥½çš„é†«ç™‚å“è³ªã€", tag: "medical" },
      { text: "è¬ä¸€ç™¼ç”Ÿæ„å¤–ï¼Œå®¶åº­ç”Ÿæ´»é‚„èƒ½æ­£å¸¸é‹ä½œ", tag: "accident" }
    ]
  }
];

let currentMode="", currentQueue=[], answers=[], currentIndex=0, currentRank=[];
let totalQuestions=0, finishedQuestions=0;

function selectTarget(mode){
  const name=document.getElementById("clientName").value.trim();
  const dob=document.getElementById("clientDob").value.trim();
  const job=document.getElementById("clientJob").value.trim();
  const contact=document.getElementById("clientContact").value.trim();
  const sex=[...document.getElementsByName("clientSex")].find(x=>x.checked)?.value;
  if(!name||!dob||!job||!contact||!sex){alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼Œä»¥ä¾¿æˆ‘å€‘æä¾›ç²¾æº–åˆ†æï¼");return;}
  currentMode=mode;
  currentQueue=(mode==="family")?questionsFamily:questionsSelf;
  totalQuestions=(mode==="both")?(questionsSelf.length+questionsFamily.length):currentQueue.length;
  document.getElementById("step-intro").classList.remove("active");
  document.getElementById("step-question").classList.add("active");
  loadQuestion();
}

function loadQuestion(){
  if(currentIndex>=currentQueue.length){handleQueueFinish();return;}
  currentRank=[];
  const q=currentQueue[currentIndex];
  document.getElementById("q-category").innerText=q.cat;
  document.getElementById("q-text").innerText=q.title;
  document.getElementById("progress").style.width=(finishedQuestions/totalQuestions*100)+"%";
  renderOptions();
}

function renderOptions(){
  const q=currentQueue[currentIndex];
  const pool=document.getElementById("q-options");pool.innerHTML="";
  q.options.forEach((o,i)=>{
    const idx=currentRank.indexOf(i);
    const div=document.createElement("div");
    div.className="option-card"+(idx>-1?" selected":"");
    div.onclick=()=>toggleOption(i);
    div.innerHTML=`<div class="rank-box">${idx>-1?idx+1:""}</div><div class="option-text">${o.text}</div>`;
    pool.appendChild(div);
  });
  const btn=document.getElementById("next-btn");
  btn.classList.toggle("ready",currentRank.length===4);
}

function toggleOption(i){
  const idx=currentRank.indexOf(i);
  if(idx>-1)currentRank.splice(idx,1);
  else if(currentRank.length<4)currentRank.push(i);
  renderOptions();
}
function resetCurrentRank(){currentRank=[];renderOptions();}

function nextQuestion(){
  if(currentRank.length<4)return;
  const q=currentQueue[currentIndex];
  answers.push({
    mode:currentQueue===questionsSelf?"self":"family",
    title:q.title,
    rankedTags:currentRank.map(i=>q.options[i].tag)
  });
  currentIndex++;finishedQuestions++;loadQuestion();
}

function handleQueueFinish(){
  if(currentMode==="both" && currentQueue===questionsSelf){
    alert("ç¬¬ä¸€éšæ®µå®Œæˆï¼æ¥ä¸‹ä¾†é€²å…¥å®¶äººè¦åŠƒéƒ¨åˆ†ã€‚");
    currentQueue=questionsFamily;currentIndex=0;loadQuestion();
  }else{
    document.getElementById("step-question").classList.remove("active");
    document.getElementById("step-check").classList.add("active");
  }
}

function finishCheck(isKnown){
  document.getElementById("step-check").classList.remove("active");
  document.getElementById("step-result").classList.add("active");

  const name = document.getElementById("clientName").value;
  const dob = document.getElementById("clientDob").value;
  const job = document.getElementById("clientJob").value;
  const contact = document.getElementById("clientContact").value;
  const sex = [...document.getElementsByName("clientSex")].find(x=>x.checked)?.value;

  // è¨ˆç®—åˆ†æ•¸
  let scores={self:{}, family:{}};
  ["lump_sum","monthly_pay","medical","accident"].forEach(k=>{
      scores.self[k]=0; scores.family[k]=0;
  });

  answers.forEach(a=>a.rankedTags.forEach((t,i)=>{
      if(scores[a.mode][t] !== undefined) {
          scores[a.mode][t] += RANK_WEIGHTS[i];
      }
  }));

  // === ğŸ”¥ é¡å‹åˆ¤å®š (èåˆè‡ªç•™/å½ˆæ€§æ¦‚å¿µï¼Œä½†ç”¨ä¸€æ¬¡é‡‘å¼·åº¦ä¾†åˆ¤æ–·) ğŸ”¥ ===
  let totalLumpSum = scores.self.lump_sum + scores.family.lump_sum;
  let totalMonthly = scores.self.monthly_pay + scores.family.monthly_pay;
  
  // è¨ˆç®—ä¸€æ¬¡é‡‘çš„å¼·åº¦ (Max 4åˆ†)
  let totalQuestions = answers.length;
  let lumpSumStrength = totalQuestions > 0 ? (totalLumpSum / totalQuestions) : 0;

  let typeTitle = "";
  let typeClass = "";
  let typeHTML = "";

  if(lumpSumStrength >= 2.8) { 
      typeTitle = "ğŸŸ¦ çµæœä¸€ï½œé«˜åº¦è‡ªç•™å‹"; 
      typeClass = "result-type-1";
      typeHTML = `
        <span class="result-title" style="color:#2980b9">${typeTitle}</span>
        <div class="result-desc">
            <b>ä½ çš„é¢¨æ ¼æ˜¯ï¼šæŠŠé¸æ“‡æ¬Šç•™åœ¨è‡ªå·±æ‰‹ä¸Š</b><br>
            ä½ å‚¾å‘ã€Œè³‡é‡‘æŒæ¡åœ¨æ‰‹ã€ï¼Œé‡åˆ°ç‹€æ³æ™‚ï¼Œå¸Œæœ›æœ‰ä¸€å¤§ç­†éŒ¢å¯ä»¥éˆæ´»èª¿åº¦ã€‚<br><br>
            <b>ä½ åœ¨æ„çš„æ˜¯ï¼š</b>
            <ul class="result-list">
                <li>è‡ªç”±åº¦èˆ‡æŒæ§æ„Ÿ (è³‡é‡‘éˆæ´»)</li>
                <li>ä¸è¢«ç”¨é€”æˆ–æ¢æ¬¾é™åˆ¶</li>
                <li>éœ€è¦æ™‚å¯ä»¥ä¸€æ¬¡åšæ±ºå®š</li>
            </ul>
            <div class="strategy-box">
               <b>ğŸ’¡ æ¨è–¦è¦åŠƒæ–¹å‘ï¼š</b><br>
               å„ªå…ˆè¦åŠƒã€Œä¸€æ¬¡çµ¦ä»˜å‹ã€çš„é‡å¤§å‚·ç—…éšªæˆ–é«˜é¡å£½éšªï¼Œç¢ºä¿è³‡é‡‘åœ¨æ‰‹ï¼Œæ“æœ‰æœ€å¤§æ±ºç­–æ¬Šã€‚
            </div>
        </div>`;
  } else if (totalMonthly > totalLumpSum) {
      // åå¥½åˆ†æœŸé‡‘/ç´°æ°´é•·æµ -> åˆ†æ•£å®‰æ’å‹
      typeTitle = "ğŸŸ¨ çµæœä¸‰ï½œåˆ†æ•£å®‰æ’å‹"; 
      typeClass = "result-type-3";
      typeHTML = `
        <span class="result-title" style="color:#f39c12">${typeTitle}</span>
        <div class="result-desc">
            <b>ä½ çš„é¢¨æ ¼æ˜¯ï¼šå»ºç«‹ç³»çµ±ï¼Œå¿ƒè£¡ä¸ç´¯</b><br>
            ä½ å‚¾å‘ã€Œç©©å®šçš„ç¾é‡‘æµã€ï¼Œæ“”å¿ƒé•·æœŸç„¡æ³•å·¥ä½œæœƒååƒå±±ç©ºï¼Œå¸Œæœ›åƒé ˜è–ªæ°´ä¸€æ¨£æœ‰ä¿éšœã€‚<br><br>
            <b>ä½ åœ¨æ„çš„æ˜¯ï¼š</b>
            <ul class="result-list">
                <li>é•·æœŸå£“åŠ›ä¸è¦é›†ä¸­åœ¨ç•¶ä¸‹</li>
                <li>ç”Ÿæ´»ç¯€å¥ä¸è¢«ç”Ÿç—…æ‰“äº‚</li>
                <li>ç©©å®šçš„è³‡æºæ”¯æ´ (å¦‚è–ªæ°´è£œå„Ÿ)</li>
            </ul>
            <div class="strategy-box">
               <b>ğŸ’¡ æ¨è–¦è¦åŠƒæ–¹å‘ï¼š</b><br>
               å„ªå…ˆè¦åŠƒã€Œåˆ†æœŸçµ¦ä»˜å‹ã€çš„å¤±èƒ½æˆ–é•·ç…§éšªï¼Œå»ºç«‹é•·æœŸçš„å®‰å…¨ç¶²ï¼Œé¿å…è¢«é•·æœŸæŠ—æˆ°æ‹–å®ã€‚
            </div>
        </div>`;
  } else {
      // å…©è€…å·®ä¸å¤šï¼Œæˆ–åå¥½å¯¦æ”¯/æ„å¤– -> æ··åˆå½ˆæ€§å‹
      typeTitle = "ğŸŸ© çµæœäºŒï½œæ··åˆå½ˆæ€§å‹"; 
      typeClass = "result-type-2";
      typeHTML = `
        <span class="result-title" style="color:#27ae60">${typeTitle}</span>
        <div class="result-desc">
            <b>ä½ çš„é¢¨æ ¼æ˜¯ï¼šå‹™å¯¦è§£æ±ºï¼Œä¿ç•™å½ˆæ€§</b><br>
            ä½ ä¸å¤ªèµ°æ¥µç«¯ï¼Œè€Œæ˜¯åå¥½ã€Œè§£æ±ºçœ¼å‰çš„å•é¡Œã€ï¼Œä¾‹å¦‚æŠŠé†«é™¢å¸³å–®ä»˜æ‰ã€‚<br><br>
            <b>ä½ åœ¨æ„çš„æ˜¯ï¼š</b>
            <ul class="result-list">
                <li>ç•¶ä¸‹å•é¡Œçš„è§£æ±º (å¦‚å¯¦å ±å¯¦éŠ·)</li>
                <li>ä¸æƒ³è¦æœ‰é¡å¤–çš„è² å‚µæˆ–æ”¯å‡º</li>
                <li>é†«ç™‚å“è³ªä¸æ‰“æŠ˜</li>
            </ul>
            <div class="strategy-box">
               <b>ğŸ’¡ æ¨è–¦è¦åŠƒæ–¹å‘ï¼š</b><br>
               å„ªå…ˆè¦åŠƒã€Œå¯¦æ”¯å¯¦ä»˜é†«ç™‚ã€èˆ‡ã€Œæ„å¤–éšªã€ï¼Œè§£æ±ºç™¼ç”Ÿç‡æœ€é«˜çš„å•é¡Œï¼Œè®“æ²»ç™‚é¸æ“‡æ›´æœ‰å½ˆæ€§ã€‚
            </div>
        </div>`;
  }

  // ç”Ÿæˆå¾Œå°å ±å‘Š
  function sort(o){return Object.entries(o).sort((a,b)=>b[1]-a[1]);}
  const sortedSelf=sort(scores.self);
  const sortedFamily=sort(scores.family);

  // æ¯”è¼ƒ éšªç¨® èˆ‡ è³‡é‡‘
  let totalMedical = scores.self.medical + scores.family.medical;
  let totalAccident = scores.self.accident + scores.family.accident;
  let riskPref = totalMedical > totalAccident ? "ğŸ¥ åå¥½é†«ç™‚ (è§£æ±ºå¸³å–®)" : "âš ï¸ åå¥½æ„å¤– (æ“”æ†‚çªç™¼)";
  let moneyPref = totalLumpSum > totalMonthly ? "ğŸ’° åå¥½ä¸€æ¬¡é‡‘ (è³‡é‡‘)" : "ğŸ—“ï¸ åå¥½åˆ†æœŸé‡‘ (ç¾é‡‘æµ)";

  let report = `ã€ğŸ§‘ å®¢æˆ¶æª”æ¡ˆã€‘\n`;
  report += `å§“åï¼š${name} (${sex})\nç”Ÿæ—¥ï¼š${dob}\nè·æ¥­ï¼š${job}\nè¯çµ¡ï¼š${contact}\n`;
  report += `ä¿å–®å¥æª¢æ„é¡˜ï¼š${isKnown ? "æ¸…æ¥š" : "âš ï¸ ä¸æ¸…æ¥š"}\n------------------------\n`;
  
  report += `ã€ğŸ§  ç¶œåˆåˆ†æçµæœã€‘\n`;
  report += `é¡å‹ï¼š${typeTitle}\n`;
  report += `1. è³‡é‡‘é¢¨æ ¼ï¼š${moneyPref}\n`;
  report += `2. é¢¨éšªé‡å¿ƒï¼š${riskPref}\n\n`;

  report += `ã€ğŸ“Š è©³ç´°æ¬Šé‡æ’åã€‘\n`;
  if(currentMode === "self" || currentMode === "both"){
      report += `[è‡ªæˆ‘è¦åŠƒ]\n` + sortedSelf.filter(s=>s[1]>0).map(s=>`ğŸ”¹${TAG_MAP[s[0]]}: ${s[1]}åˆ†`).join("\n") + "\n\n";
  }
  if(currentMode === "family" || currentMode === "both"){
      report += `[å®¶äººè¦åŠƒ]\n` + sortedFamily.filter(s=>s[1]>0).map(s=>`ğŸ”¸${TAG_MAP[s[0]]}: ${s[1]}åˆ†`).join("\n");
  }

  // 4. å‚³é€
  fetch(scriptURL, {
    method: "POST", mode: "no-cors", 
    headers: {"Content-Type": "text/plain"},
    body: JSON.stringify({ name: name, mode: currentMode, analysis: report })
  })
  .then(() => {
      document.getElementById("final-message").style.display = "none";
      let resultContainer = document.getElementById("analysis-content");
      
      let html = `
        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="color: #27ae60; margin:0;">âœ… åˆ†æå®Œæˆ</h2>
            <p>æ„Ÿè¬æ‚¨çš„å¡«å¯«ï¼ä»¥ä¸‹æ˜¯æ‚¨çš„åˆ†æçµæœï¼š</p>
        </div>
        
        <div class="result-card ${typeClass}">
            ${typeHTML}
        </div>
      `;

      if(!isKnown) {
          html += `
            <div style="background:#fff3cd;color:#856404;padding:15px;border-radius:8px;margin-top:20px;text-align:center;">
                <strong>ğŸ’¡ è²¼å¿ƒæé†’</strong><br>
                å»ºè­°é ç´„ä¿å–®å¥æª¢ï¼Œé¿å…é‡è¤‡æŠ•ä¿ï¼
            </div>
          `;
      }
      
      html += `<button class="nav-btn ready" onclick="location.reload()" style="margin-top:30px">é—œé–‰</button>`;
      
      resultContainer.innerHTML = html;
  })
  .catch(() => alert("å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯"));
}
</script>
</body>
</html>
